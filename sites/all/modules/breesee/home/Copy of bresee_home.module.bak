<?php


// $Id: breesee_home.module $

/**
**	
*/

function bresee_home_perm() {
	return array(
		'admininster breesee',
		'place claim request', 
		'mange claim request', 
		'mange store',
		'breesee portfolio',
		);
}

/**
**	
*/

function bresee_home_init() {
	modalframe_parent_js();
	drupal_add_js(drupal_get_path('module', 'modalframe_example') .'/modalframe_example.js');
}

/**
**	
*/

function bresee_home_block($op = 'list', $delta = 0) {
  $block = array();
  switch ($op) {
    case 'list':
      	$block[0]['info'] = t('Blog Filter by Location'); 
			$block[1]['info'] = t('No Login Left News Block'); // Pending
			$block[2]['info'] = t('Blog Add Block');
			$block[3]['info'] = t('FBSSMB Block');
			$block[4]['info'] = t('No Login Home Menu');
			$block[5]['info'] = t('Home Image Slider');
			$block[6]['info'] = t('City Filter Category');
			$block[7]['info'] = t('City Filter Price');
			$block[8]['info'] = t('City Filter Where');
			$block[9]['info'] = t('City Filter History');
			$block[10]['info'] = t('Store Banner Rotator');
			$block[11]['info'] = t('My Products');
			$block[12]['info'] = t('Store Detail Rightside');
			$block[13]['info'] = t('Creator Filter Category');
			$block[14]['info'] = t('Creator Filter Where');
			$block[15]['info'] = t('Index Nologin Blog Block');
			$block[16]['info'] = t('Facebbok Share Complete');
			$block[17]['info'] = t('Creator Detail Blog [Arg]');
			$block[18]['info'] = t('Creations [Arg]');
			$block[19]['info'] = t('Home Page Menu');
			$block[20]['info'] = t('User Followers BIG');
			$block[21]['info'] = t('Address Add Block');
			$block[22]['info'] = t('Favorite Products');
    return $block;
    case 'view':
      switch ($delta) {
        case 0:
          $block['subject'] = t('Blog Filter by Location');
          $block['content'] = bresee_home_nologin_location_menu();
        	break;     
				case 1:
          $block['subject'] = t('No Login Left News Block');
          $block['content'] = bresee_home_nologin_left_news();
        	break;  
				case 2:
          $block['subject'] = t('Blog Add Block');
          $block['content'] = bresee_home_add_blog();
        	break;  
				case 3:
          $block['subject'] = t('FBSSMB Block');
          $block['content'] = bresee_fbsmp_form_block();
        	break;  
				case 4:
          $block['subject'] = t('No Login Home Menu');
          $block['content'] = bresee_nologin_homemenu();
        	break; 
				case 5:
          $block['subject'] = t('Home Image Slider');
          $block['content'] = bresee_nologin_homeslider();
        	break; 
				case 6:
          $block['subject'] = t('City Filter Category');
          $block['content'] = bresee_city_filter_cat();
        	break; 
				case 7:
          $block['subject'] = t('City Filter Price');
          $block['content'] = bresee_city_filter_price();
        	break;
				case 8:
          $block['subject'] = t('City Filter Where');
          $block['content'] = bresee_city_filter_where();
        	break;
				case 9:
          $block['subject'] = t('City Filter History');
          $block['content'] = bresee_city_filter_history();
        	break;
				case 10:
          $block['subject'] = t('Store Banner Rotator');
          $block['content'] = bresee_city_banner_rotator();
        	break;
				case 11:
          $block['subject'] = t('My Products');
          $block['content'] = bresee_city_myproducts();
        	break;
				case 12:
          $block['subject'] = t('Store Detail Rightside');
          $block['content'] = bresee_city_detailright();
        	break;
				case 13:
          $block['subject'] = t('Creator Filter Category');
          $block['content'] = bresee_creator_filter_category();
        	break;
				case 14:
          $block['subject'] = t('Creator Filter Where');
          $block['content'] = bresee_creator_filter_where();
        	break;
				case 15:
          $block['subject'] = t('Index Nologin Blog Block');
          $block['content'] = bresee_index_nologin_blogblock();
        	break;
				case 16:
          $block['subject'] = t('Facebbok Share Complete');
          $block['content'] = bresee_facebook_like_share_complete();
        	break;
				case 17:
          $block['subject'] = t('Creator Detail Blog [Arg]');
          $block['content'] = bresee_index_nologin_blogblock_arg();
        	break;
				case 18:
          $block['subject'] = t('Creations [Arg]');
          $block['content'] = bresee_creations_arg(); // also a page in breesee.module 
        	break;
				case 19:
          $block['subject'] = t('Home Page Menu');
          $block['content'] = bresee_homepage_left_menu(); 
        	break;
				case 20:
          $block['subject'] = t('User Followers BIG');
          $block['content'] = bresee_followeers_list(); 
        	break;
				case 21:
          $block['subject'] = t('Address Add Block');
          $block['content'] = bresee_home_add_address(); 
        	break;
				case 22:
          $block['subject'] = t('Favorite Products');
          $block['content'] = bresee_favorite_products(); 
        	break;
      }
     return $block;
  }
}

function bresee_home_nologin_location_menu() {
		
		global $base_url;
		$query = "select tid, name from {term_data} where vid = 13 and tid in (select tid from term_hierarchy where parent = 0 ) " ;
		$query_result = db_query($query);
		$blockk = '<ul id="nologinfilter">';
		while($row = db_fetch_object($query_result)) {
			$tid = $row->
tid;
			$termname = $row->name;
			$blockk .= '<li class="pop parentid" ><a href="theblog/filter/'.$tid.'" rel="tooltip" class="ajax" ajax="theblog/filter/'. $tid .'">' . $termname. ' + </a></li>';
		}
		$blockk .= '</ul>';
		return $blockk;
}

//_gettermsname


function bresee_home_nologin_left_news () {
	$sql = "SELECT distinct node.nid, node.uid ,content_field_city.field_city_value as tid, facebook_status.message as message 
					FROM `node` 
					LEFT JOIN content_field_city 
					ON content_field_city.nid = node.nid
					LEFT JOIN facebook_status
					ON facebook_status.sender = node.uid 
					GROUP BY node.uid";
	$result = db_query($sql);
	$html = '';
	$html .= '<div class="hom_cat"><h3>Updated News</h3><div class="ho_cat_contan">';
	while($row = db_fetch_object($result)) {
		$tid = $row->tid;
		$message = $row->message;
		$html .= '<h2>'._gettermsname($tid).'</h2>
                    <p>'.substr($message,0, 25).'...</p>';
	}
	$html .= '</div></div>';
	return $html;
}

function bresee_home_add_blog() {	
	global $user;
    module_load_include('inc', 'node', 'node.pages');
    $type = 'blog';
    // Initialize settings:
    $node = array(
      'uid' => $user->uid,
      'name' => (isset($user->name) ? $user->name : ''),
      'type' => $type,
      'language' => '',
    );
    return drupal_get_form($type . '_node_form', $node);
}

function bresee_home_add_address() {	
	global $user;
    module_load_include('inc', 'node', 'node.pages');
    $type = 'address';
    // Initialize settings:
    $node = array(
      'uid' => $user->uid,
      'name' => (isset($user->name) ? $user->name : ''),
      'type' => $type,
      'language' => '',
    );
    return drupal_get_form($type . '_node_form', $node);
}

function bresee_fbsmp_form_block() {	
	global $user;
	$url = arg(1);
	if ($url == 'home')
		$userk =  $user;
	else
		$userk = user_load(arg(1));
		
  $view = variable_get('facebook_status_share_view', 'facebook_status');
  return theme('facebook_status_form_display', $userk, 'user');
}
function bresee_nologin_homemenu() {
	$html = '';
	global $user, $base_url;
	//drupal_add_js(drupal_get_path('module', 'breesee') . '/js/fetchhome.js');
	drupal_add_js(drupal_get_path('module', 'swftools') . '/flash_media_player/swfobject.js');
	$html .= '<div class="item-list"><ul id="nologinhomemmnu">';
	$html .= '<li> <a class="fb" href = "theblog/filter/all">Home</a></li>';
	$html .= '<li> <a class="video" href = "fbvideos">Video</a></li>';
	$query = "SELECT term_data.tid AS tid, term_data.name AS term_data_name, term_data.vid AS term_data_vid FROM term_data term_data  WHERE term_data.vid in ('12') " ;
		$query_result = db_query($query);
		while($row = db_fetch_object($query_result)) {
			$tid = $row->tid;
			$term_data_name = $row->term_data_name;
			$url = 'theblog';
			if((arg(0) == 'creator') && is_numeric(arg(1)))
			$url = 'cretorblog';
			if((arg(0) == 'store') && is_numeric(arg(1)))
			$url = 'cretorblog';
			
			$html .= '<li> <a class="ajax" href = "'.$url.'/main/'.$tid.'/'.arg(1).'">' .$term_data_name. '</a></li>';
			}
	$html .= '</ul></div>';
	return $html;
}

function bresee_nologin_homeslider() {
	global $user, $base_url;
	drupal_add_css(drupal_get_path('theme', 'BreeseeUK').'/easyslider/css/screen.css');
	drupal_add_js(drupal_get_path('theme', 'BreeseeUK').'/easyslider/js/easySlider.js');
	drupal_add_js('$(document).ready(function(){$("#slider").easySlider({auto: true, continuous: true});});	','inline');	
		
	$html = '<div id="container">
			 <div id="header"></div>
 			<div id="content">
			<div id="slider">
			<ul>';	
				$sql = "SELECT nid from node where type = 'featured_slider' ";
				$result = db_query($sql);
				$k = '';
				$cnt = 1;
				$row = db_fetch_object($result);
				$node = node_load($row->nid);
				//print_r($node);
				for($i=0; $i<=4; $i++) {
				$html .='	<li>'. theme('imagecache',  'home_slider_978x260' , $node->field_featured_slider[$i]['filepath'],  $node->field_image1[$i]['data']['alt'], $node->field_image1[$i]['data']['title'] ) .'<div class="bannercontnt">
									<h2>'. $node->title .'</h2>
									<p>'.  $node->field_featured_slider[$i]['data']['description'] .'</p>
									</div></li>';
				}

	$html .='</ul>
				</div>
				</div>
				</div>';
	return $html;
}

function bresee_city_filter_cat () {
	$html = '';
	global $user, $base_url;
	$html .= '<div class="category_block"><h1>Categories</h1><div class="item-list"><ul id="cityfilter">';
	$query = "SELECT term_data.tid AS tid, term_data.name AS term_data_name, term_data.vid AS term_data_vid FROM term_data term_data  WHERE term_data.vid in ('18') " ;
		$query_result = db_query($query);
		while($row = db_fetch_object($query_result)) {
			$tid = $row->tid;
			$term_data_name = $row->term_data_name;
			$html .= '<li> '.taxonomy_image_display($tid).'<a href = "'.$base_url.'/cities/category/'.$tid.'">' .$term_data_name. ' ( '.taxonomy_term_count_nodes($tid).' ) </a></li>
								';
			}
	$html .= '</ul></div></div>';
	return $html;
}


function bresee_city_filter_price() {
$html = '';
	global $user, $base_url;
	$html .= '<div class="category_block"><h1>Price</h1><div class="item-list"><ul id="cityfilter">';
	$query = "SELECT term_data.tid AS tid, term_data.name AS term_data_name, term_data.vid AS term_data_vid FROM term_data term_data  WHERE term_data.vid in ('19') " ;
		$query_result = db_query($query);
		while($row = db_fetch_object($query_result)) {
			$tid = $row->tid;
			$term_data_name = $row->term_data_name;
			$html .= '<li> '.taxonomy_image_display($tid).'<a href = "'.$base_url.'/cities/price/'.$tid.'">' .$term_data_name. ' ( '.taxonomy_term_count_nodes($tid).' ) </a></li>
								';
			}
	$html .= '</ul></div></div>';
	return $html;
}

function bresee_city_filter_where() {
		global $base_url;
		drupal_add_js(drupal_get_path('module', 'breesee') . '/js/ajaxtooltip.js');
		$query = "select tid, name from {term_data} where vid = 13 and tid in (select tid from term_hierarchy where parent = 0 ) " ;
		$query_result = db_query($query);
		$blockk = '<div class="category_block"><h1>Where</h1><ul id="nologinfilter">';
		while($row = db_fetch_object($query_result)) {
			$tid = $row->tid;
			$termname = $row->name;
			$blockk .= '<li class="pop parentid" ><a class="contry" href="'.$base_url.'/cities/location/'.$tid.'" title="ajax:nextlevel/'.$tid.'" >' . $termname. ' + </a></li>';
		}
		$blockk .= '</ul></div>';
		return $blockk;
}

function bresee_city_filter_history() {
$html = '';
	global $user, $base_url;
	$html .= '<div class="category_block"><h1>History</h1><div class="item-list"><ul id="cityfilter">';
	$query = "SELECT term_data.tid AS tid, term_data.name AS term_data_name, term_data.vid AS term_data_vid FROM term_data term_data  WHERE term_data.vid in ('20') " ;
		$query_result = db_query($query);
		while($row = db_fetch_object($query_result)) {
			$tid = $row->tid;
			$term_data_name = $row->term_data_name;
			$html .= '<li> '.taxonomy_image_display($tid).'<a href = "'.$base_url.'/cities/history/'.$tid.'">' .$term_data_name. ' ( '.taxonomy_term_count_nodes($tid).' ) </a></li>
								';
			}
	$html .= '</ul></div></div>';
	return $html;
}


function bresee_city_banner_rotator () {
	$strid = arg(1);
	global $user, $base_url;
	drupal_add_js(drupal_get_path('theme', 'BreeseeUK').'/js/mobilyslider.init.js');
	drupal_add_js(drupal_get_path('theme', 'BreeseeUK').'/js/mobilyslider.js');
	$html = '<div class="slider">
			<div class="sliderContent">';	
				$sql = "SELECT nid from node where type = 'featured_slider' and uid = '$strid' ";
				$result = db_query($sql);
				$row = db_fetch_object($result);
				$node = node_load($row->nid);
				for($i=0; $i<=4; $i++) {
				$html .='	<div class="item">'. theme('imagecache',  'center_image' , $node->field_featured_slider[$i]['filepath'],  $node->field_featured_slider[$i]['data']['alt'], $node->field_featured_slider[$i]['data']['title'] ) .'<div class="smal_scroller">
									<h2><strong>'. $node->title .'</strong></h2>
									<p>'.$node->teaser.'</p>
									</div></div>';
				}
	$html .='
				</div>
				</div>';
	$html .='<div class="clear"></div>';
	return $html;
}

function bresee_city_myproducts() {
	global $user, $base_url;
	//drupal_add_js(drupal_get_path('module', 'breesee').'/js/jquery-ui-1.7.2.custom.js');
	//drupal_add_js(drupal_get_path('module', 'breesee').'/js/productdetailside.js');
	$strid = arg(1);
	$html = '';
	
	$html .='<div class="viewblk" id="storetab3btm">';
	$blockm = module_invoke('bresee_home', 'block', 'view', 10);
	$html .= $blockm['content'];
	$html .= '</div>';
	
	$html .= '<div class="stor_tab3prod"><div class="spacer"></div>';
	$html .= _bree_product_filter();
	$html .= '<div class="clear"></div><ul class="stor_tab3produl">';
	$sql = "SELECT distinct nid from node where type = 'product' and uid = '$strid' ";
	$result = db_query($sql);
	while($row = db_fetch_object($result)) {
		$node = node_load($row->nid);
		//print_r($node);
		$html .= '<li> <div class="mainDiv"><div class="showDiv" >';
		$html .= theme('imagecache', 'store_page_product_images', $node->field_image_cache[0]['filepath'], $alt, $title, $attributes);
		$html .= '<h1>'.$node->title.'</h1>';
		$terms = taxonomy_node_get_terms($node);
		foreach($terms as $term){ 
		$html .= '<span>'.$term->name .'</span>';
		}
		$html .= '</div><div style="display: none; left: 68px;" class="slideDiv">
                What do you see?!
            </div></div> </li>';
	}
	$html .= '</ul></div>';
	return $html;
}

function bresee_city_detailright() {
	drupal_add_js(drupal_get_path('module', 'breesee').'/js/followme.js');
	$uid = arg(1);
	$stor_usr = user_load($uid);
	global $user, $base_url;
	$html = '';
	$html .= '<div class="storright">';
	$html .= '<h1>Share '.$stor_usr->name.' with your Friends</h1>';
	$block = module_invoke('addthis', 'block', 'view',0);
	$html .= $block['content'];
	$sql = "select count(requester_id) from {friendlist_relations} where rtid = '2' and requestee_id = '$uid ' "; // 2=> Follower
	$folnos = db_result(db_query($sql));
	$html .= '<h1>'.$stor_usr->name.' has <span id="folow_count">'.$folnos.'</span> Followers </h1>';
	$html .= '<div id="followmediv">';
	if($user->uid) {
		if(! doIFollow($uid))
		$html .= '<a href="javascript:void(0)" rel="'.$uid .'" id="followme"><p id="ftxt">Followers</p></a>';
		else 
		$html .= '<a href="javascript:void(0)" rel="nofollow" id="followme" style="cursor:default"><p id="ftxt">Following</p></a>';
	}
	else 
	$html .= '<a href="'.$base_url.'/breesee/login" id="followme" class="modalframe-example-child modalframe-example-size[350,400]"><p id="ftxt">Followers</p></a>';
	$html .= '</div><div id="followers"></div>';
	$html .= '<h1>Your Next '.ucfirst(arg(0)).'</h1>';
	$rid = 5;
	if (arg(0) == 'store' ) 
	$rid = 6;
	$html .= _breesee_next_users(arg(1), $rid);
	$html .= '</div>';
	return $html;
}





function _bree_product_filter() { // Use in fn. bresee_city_myproducts
drupal_add_css(drupal_get_path('module', 'breesee').'/js/ddsmoothmenu.css');
drupal_add_js(drupal_get_path('module', 'breesee').'/js/ddsmoothmenu.js');
drupal_add_js(drupal_get_path('module', 'breesee').'/js/dd.js');
$html = '
<div id="smoothmenu1" class="ddsmoothmenu">
<ul>
<li>Filter</li>
<li><a href="#">Price +</a>
  <ul>
		<li><a href="price" rel="0,100" >0 - 100</a></li>
		<li><a href="price" rel="00,1000" >100 - 1000 </a></li>
		<li><a href="price" rel="1000,10000" >1000 - 10000 </a></li>  
		<li><a href="price" rel="10000,100000" >10000 - 100000 </a></li> 
	</ul>
</li>
<li><a href="#">Category +</a>
  <ul>
  <li><a href="category">Sub Item 1.1</a></li>
  <li><a href="category">Sub Item 1.2</a></li>
  <li><a href="category">Sub Item 1.3</a></li>
  </ul>
</li>
<li><a href="#">Colour +</a>
  <ul>
  <li><a href="colour">Sub Item 1.1</a></li>
  <li><a href="colour">Sub Item 1.2</a></li>
  <li><a href="colour">Sub Item 1.3</a></li>
  </ul>
</li>
</ul>
</div>';
return $html;
}



function bresee_creator_filter_category() {
	$html = '';
	global $user, $base_url;
	$html .= '<div class="category_block"><h1>Categories</h1><div class="item-list"><ul id="cityfilter">';
	$query = "SELECT term_data.tid AS tid, term_data.name AS term_data_name, term_data.vid AS term_data_vid FROM term_data term_data  WHERE term_data.vid in ('22') " ;
		$query_result = db_query($query);
		while($row = db_fetch_object($query_result)) {
			$tid = $row->tid;
			$term_data_name = $row->term_data_name;
			$html .= '<li> '.taxonomy_image_display($tid).'<a href = "'.$base_url.'/creators/category/'.$tid.'">' .$term_data_name. ' ( '.taxonomy_term_count_nodes($tid).' ) </a></li>';
			}
	$html .= '</ul></div></div>';
	return $html;
}


function bresee_creator_filter_where() {
		global $base_url;
		drupal_add_js(drupal_get_path('module', 'breesee') . '/js/ajaxtooltip.js');
		$query = "select tid, name from {term_data} where vid = 13 and tid in (select tid from term_hierarchy where parent = 0 ) " ;
		$query_result = db_query($query);
		$blockk = '<div class="category_block"><h1>Where</h1><ul id="cityfilter">';
		while($row = db_fetch_object($query_result)) {
			$tid = $row->tid;
			$termname = $row->name;
			$blockk .= '<li class="pop parentid" ><a class="contry" href="'.$base_url.'/creators/location/'.$tid.'" title="ajax:nextlevel/'.$tid.'" >' . $termname. ' + </a></li>';
		}
		$blockk .= '</ul></div>';
		return $blockk;
}

function bresee_index_nologin_blogblock() {
	//drupal_add_js(drupal_get_path('module', 'breesee') . '/js/nologinblogfilter.js');
	//$query_count    = "SELECT count(node.nid) FROM node inner join term_node on term_node.nid = node.nid and term_node.tid in(2307, 2309, 2310) ";
	$filter = arg(1);
	$sql    = "SELECT node.nid AS nid, users.uid AS users_uid FROM node node  LEFT JOIN term_node term_node ON node.vid = term_node.vid INNER JOIN users users ON node.uid = users.uid LEFT JOIN node_revisions node_revisions ON node.vid = node_revisions.vid WHERE (node.type in ('blog'))";

	$query_count    = "SELECT count(node.nid) FROM node WHERE (node.type in ('blog')) ";
	if($filter != '') {
		switch ($filter) {
			case 'category' :
				$_SESSION['city']['category'] = arg(2);
			break;
			case 'history' :
				$_SESSION['city']['history'] = arg(2);
			break;
			case 'price' :
				$_SESSION['city']['price'] = arg(2);
			break;
			case 'location' :
				$_SESSION['city']['location'] = arg(2);
			break;
		}
		$nids_str = implode(", ", $_SESSION['city']);
		$query = "select distinct uid from {node} where nid in ( select 	nid from {term_node} where tid in ($nids_str) )" ;
		$query_result = db_query($query);
		while($row = db_fetch_object($query_result)) {
			$uid[] = $row->uid;
		}
		$uid_str = implode(", ", $uid);
		$sql    = "SELECT node.nid AS nid, node.language AS node_language, users.picture AS users_picture, users.uid AS users_uid, users.name AS users_name, users.mail AS users_mail, node.created AS node_created, node.title AS node_title, node_revisions.body AS node_revisions_body, node_revisions.format AS node_revisions_format FROM node node  LEFT JOIN term_node term_node ON node.vid = term_node.vid INNER JOIN users users ON node.uid = users.uid LEFT JOIN node_revisions node_revisions ON node.vid = node_revisions.vid WHERE (node.type in ('blog')) AND (term_node.tid IN (2307, 2309, 2310)) order by created asc ";
		$query_count = "SELECT COUNT(*) FROM (" . $sql . ") AS count_query";
	}
	$query_count = "SELECT COUNT(*) FROM (" . $sql . ") AS count_query";
	$result = pager_query($sql,20,0,$query_count);
  while($row = db_fetch_array($result)){
    $blogs[] = node_load($row['nid']);
  } 
  $pager =  array('#value' => theme('pager', NULL, 9, 0));
	$data['pager'] =  $pager;
	$data['blogs']  = $blogs;

  $res = db_fetch_array(db_query($query_count));
  if(arg(3) == 'ajax') {
		print theme('nologin_blogblock',$data);
	}
	else {
		return theme('nologin_blogblock',$data);
	}
}

function bresee_facebook_like_share_complete() {

	$block = module_invoke('block', 'block_view', 'facebook_status');
	print $block['content'];
}


function bresee_index_nologin_blogblock_arg() {
	$filter = arg(1);
	$sql    = "SELECT node.nid AS nid from node  WHERE (node.type in ('blog')) and node.uid =  $filter ";
	$query_count    = "SELECT count(node.nid) FROM node WHERE (node.type in ('blog')) and node.uid =  $filter ";
	$result = pager_query($sql,20,0,$query_count);
  while($row = db_fetch_array($result)){
    $blogs[] = node_load($row['nid']);
  } 
  $pager =  array('#value' => theme('pager', NULL, 9, 0));
	$data['pager'] =  $pager;
	$data['blogs']  = $blogs;

  $res = db_fetch_array(db_query($query_count));
  if(arg(3) == 'ajax') {
		print theme('nologin_blogblock',$data);
	}
	else {
		return theme('nologin_blogblock',$data);
	}
}

function bresee_creations_arg() {
	drupal_add_js(drupal_get_path('module', 'breesee') . '/js/creationfit.js');
	drupal_add_js(drupal_get_path('module', 'breesee') . '/js/jquery.jcarousel.min.js');
	drupal_add_css(drupal_get_path('module', 'breesee') . '/js/skin.css');
	$uid = arg(1);
	$sql    = "SELECT node.nid AS nid FROM node WHERE (node.type in ('creations')) and uid = $uid";
	$query_count = "SELECT COUNT(*) FROM (" . $sql . ") AS count_query";
	$result = pager_query($sql,20,0,$query_count);
  while($row = db_fetch_array($result)){
    $creations[] = node_load($row['nid']);
  } 
  $pager =  array('#value' => theme('pager', NULL, 9, 0));
	$data['pager'] =  $pager;
	$data['creations']  = $creations;
  $res = db_fetch_array(db_query($query_count));
  if(arg(3) == 'ajax') {
		print theme('creations_block',$data);
	}
	else {
		return theme('creations_block',$data);
	}
}

function doIFollow($fid) {
	global $user;
	$uid = $user->uid;
	$sql = "select count(*) from {friendlist_relations} where rtid = '2' and requester_id	 = $uid and requestee_id = '$fid ' "; 
	$res = db_result(db_query($sql));
	if($res == 1) 
	return true;
	else 
	return false;

}


function bresee_homepage_left_menu() {
	$data = array();
	return theme('bresee_homepage_left_menu',$data);
}
function bresee_followeers_list() {
	drupal_add_js(drupal_get_path('module', 'breesee') . '/js/followermix.js');
	$html = '';
	$html .= '<div id="followerorfollowing"><a href="javascript:void(0);" class="active" rel="Followers">Followers</a><a href="javascript:void(0);" rel="Following">Following</a></div>';
	$html .= '<div class="clear"></div>';
	$html .= '<div id="followers_content"></div>';
	$html .= '<div class="clear"></div>';
	return $html;
}


function bresee_favorite_products() {
	$html = '';
	global $user;
	$uid = $user->uid;
	//$uid = 1; // dev
	$sql = "SELECT favorite_nodes.nid as nid from favorite_nodes LEFT JOIN node ON favorite_nodes.nid = node.nid WHERE node.type = 'product' AND favorite_nodes.uid = $uid ";
	$count_query = "SELECT COUNT(*) FROM (" . $sql . ") AS count_query";
	$result_set = pager_query($sql, 5, 0 , $count_query);
  while($row = db_fetch_array($result_set)){
    $fav_pro[] = node_load($row['nid']);
  } 
	$pager =  array('#value' => theme('pager', NULL, 5, 0));
	$data['pager'] =  $pager;
	$data['fav_pro']  = $fav_pro;
	if(arg(3) == 'ajax') {
		print theme('favorite_products',$data);
	}
	else {
		return theme('favorite_products',$data);
	}
	
}

